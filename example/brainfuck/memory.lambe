impl lang.bool
impl lang.char
impl lang.int
impl lang.product
impl lang.string

impl zipper

type Memory = Zipper int * String

impl Memory {
    sig new      : self
    sig cursor   : self -> Int -> self
    sig memory   : self -> Int -> self
    sig nullify  : self -> self
    sig input    : self -> self with Reader Char
    sig output   : self -> self
    sig needJump : self -> Bool

    def new = zipper new 0 , ""

    def cursor offset =
        let move =
            if (offset > 0)
            then Zipper.right
            else Zipper.left
        in let loop mem offset =
            if (offset = 0)
            then { acc, self.second }
            else { loop (mem move) (offset --) }
        in loop self.first (offset abs)

    def memory value =
        (self fist replace $ value +) , (self.second)

    def nullify =
        (self first replace_by 0) , self.second

    def input =
        (self first replace_by $ Char read toInt) , self.second

    def output =
        (self first, self second + $ self first current toChar )

    def needJump = self current == 0
}
