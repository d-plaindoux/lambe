/**
 * Ref http://comonad.com/reader/2011/free-monads-for-less/
 */

type Free (f:type -> type) a =
  data Return   { value: a }
| data FlatMap i
    value: i
    cont: i -> Free f a
  }

impl for Free f {
    sig flatMap : self -> (a -> b) -> Free f b
    def flatMap f =
        when self {
            is Return  -> Return $ f self.value
            is FlatMap -> FlatMap self.value { self.cont $1 flatMap f }
        }

    sig lift : f a -> Free f a
    def lift a = FlatMap a Return
}



